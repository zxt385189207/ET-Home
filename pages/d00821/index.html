<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Actor Location-EN | ET</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/logo1.png">
    <meta name="description" content="ET是一个开源的游戏客户端基于『unity3d』服务端双端框架">
    <meta name="keywords" content="ET,et,game,framework,ECS,Server">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.8127fba6.css" as="style"><link rel="preload" href="/assets/js/app.ffc2a9fd.js" as="script"><link rel="preload" href="/assets/js/2.fbbdf61d.js" as="script"><link rel="preload" href="/assets/js/33.b6c2eaeb.js" as="script"><link rel="prefetch" href="/assets/js/10.e97fa32e.js"><link rel="prefetch" href="/assets/js/11.54d332e4.js"><link rel="prefetch" href="/assets/js/12.f44a82d3.js"><link rel="prefetch" href="/assets/js/13.6a997ef1.js"><link rel="prefetch" href="/assets/js/14.91eebba8.js"><link rel="prefetch" href="/assets/js/15.f0fe1a2f.js"><link rel="prefetch" href="/assets/js/16.f6a93be8.js"><link rel="prefetch" href="/assets/js/17.e69838fc.js"><link rel="prefetch" href="/assets/js/18.b4d244df.js"><link rel="prefetch" href="/assets/js/19.77ce86be.js"><link rel="prefetch" href="/assets/js/20.522c38c6.js"><link rel="prefetch" href="/assets/js/21.5ddc1ccf.js"><link rel="prefetch" href="/assets/js/22.99e8ee68.js"><link rel="prefetch" href="/assets/js/23.82c4363e.js"><link rel="prefetch" href="/assets/js/24.be760363.js"><link rel="prefetch" href="/assets/js/25.9cf1c272.js"><link rel="prefetch" href="/assets/js/26.63cf55ed.js"><link rel="prefetch" href="/assets/js/27.1b095ee3.js"><link rel="prefetch" href="/assets/js/28.2eb24b37.js"><link rel="prefetch" href="/assets/js/29.ed14162b.js"><link rel="prefetch" href="/assets/js/3.8494f848.js"><link rel="prefetch" href="/assets/js/30.5dcfd290.js"><link rel="prefetch" href="/assets/js/31.3dc6860b.js"><link rel="prefetch" href="/assets/js/32.5b6b946d.js"><link rel="prefetch" href="/assets/js/34.60de0211.js"><link rel="prefetch" href="/assets/js/35.12f403f4.js"><link rel="prefetch" href="/assets/js/36.a30ab135.js"><link rel="prefetch" href="/assets/js/37.83ffe510.js"><link rel="prefetch" href="/assets/js/38.1465e967.js"><link rel="prefetch" href="/assets/js/39.0e48601a.js"><link rel="prefetch" href="/assets/js/4.cd0c8f84.js"><link rel="prefetch" href="/assets/js/40.6349f9cb.js"><link rel="prefetch" href="/assets/js/5.2d050595.js"><link rel="prefetch" href="/assets/js/6.42e16043.js"><link rel="prefetch" href="/assets/js/7.8e7e3e5a.js"><link rel="prefetch" href="/assets/js/8.58eb5208.js"><link rel="prefetch" href="/assets/js/9.79c3d2c0.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8127fba6.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo1.png" alt="ET" class="logo"> <span class="site-name can-hide">ET</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><!----> <span class="title" style="display:;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a2f161/" class="nav-link">指南</a></li><li class="dropdown-item"><!----> <a href="/pages/1e1b9a/" class="nav-link">Guide</a></li><li class="dropdown-item"><!----> <a href="/doc/notes/" class="nav-link">提交文档</a></li></ul></div></div><div class="nav-item"><a href="https://et-framework.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  论坛
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/egametang/ET" target="_blank" rel="noopener noreferrer" class="nav-link external">
  💖ET-Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/zxt385189207/ET-homepage" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="指南" class="dropdown-title"><!----> <span class="title" style="display:;">指南</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/a2f161/" class="nav-link">指南</a></li><li class="dropdown-item"><!----> <a href="/pages/1e1b9a/" class="nav-link">Guide</a></li><li class="dropdown-item"><!----> <a href="/doc/notes/" class="nav-link">提交文档</a></li></ul></div></div><div class="nav-item"><a href="https://et-framework.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  论坛
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://github.com/egametang/ET" target="_blank" rel="noopener noreferrer" class="nav-link external">
  💖ET-Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <a href="https://github.com/zxt385189207/ET-homepage" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>ETBook_English</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/1e1b9a/" class="sidebar-link">RunGuide</a></li><li><a href="/pages/f9f601/" class="sidebar-link">Why use .net core</a></li><li><a href="/pages/97d2cf/" class="sidebar-link">CSharp Coroutine</a></li><li><a href="/pages/e03bce/" class="sidebar-link">Better Coroutine</a></li><li><a href="/pages/735741/" class="sidebar-link">Single-threaded asynchronous</a></li><li><a href="/pages/947d76/" class="sidebar-link">The powerful MongoBson library</a></li><li><a href="/pages/b631b2/" class="sidebar-link">Everything is Entity</a></li><li><a href="/pages/53296b/" class="sidebar-link">EventSystem</a></li><li><a href="/pages/66fec6/" class="sidebar-link">Component-based design</a></li><li><a href="/pages/a3279e/" class="sidebar-link">Actor Model</a></li><li><a href="/pages/d00821/" aria-current="page" class="active sidebar-link">Actor Location-EN</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/pages/ae8fe0/" class="sidebar-link">Numerical component design</a></li><li><a href="/pages/58cf5c/" class="sidebar-link">AI Framwork</a></li><li><a href="/pages/b70448/" class="sidebar-link">test2</a></li><li><a href="/pages/578b97/" class="sidebar-link">test</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><span data-v-06225672>Guide</span></li><li data-v-06225672><span data-v-06225672>ETBook_English</span></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/egametang/ET" target="_blank" title="作者" class="beLink" data-v-06225672>熊猫</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2022-05-31</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Actor Location-EN<!----></h1>  <div class="theme-vdoing-content content__default"><h1 id="actor-location"><a href="#actor-location" class="header-anchor">#</a> Actor Location</h1> <h3 id="actor-location-2"><a href="#actor-location-2" class="header-anchor">#</a> Actor Location</h3> <p>Actor model only needs to know each other's InstanceId to send messages, which is very convenient, but sometimes we may not know each other's InstanceId, or an Actor's InstanceId will change. ET provides a mechanism to send messages to such objects, called Actor Location The mechanism is called Actor Location. The principle is relatively simple.</p> <ol><li>because the InstanceId is changing, the object's Entity.Id is unchanged, so we can first think of using Entity.Id to send actor messages</li> <li>provide a location process (Location Server), the Actor object can store its Entity.Id and InstanceId as kv to the location process. Before sending the Actor message, go to the location process to look up the InstanceId of the Actor object before sending the actor message. 3.</li> <li>When an Actor object is created in a process or migrated to a new process, it needs to register its Id and InstanceId to the Location Server. 4.</li> <li>because the Actor object can be migrated, the message may be sent to the Actor has been migrated to other processes, so sending the Actor Location message needs to provide a reliable mechanism</li> <li>ActorLocationSender provides two methods, Send and Call, Send a message also requires the recipient to return a message, and only when the return message is received will the next message be sent. 6.</li> <li>If the Actor object is migrated away, it will return the error that the Actor does not exist, the sender will wait for 1 second after receiving this error, then go back to get the InstanceId of the Actor and resend it, currently it will try 5 times, after 5 times, it will throw an exception and report the error</li> <li>ActorLocationSender will not query the Location Server every time it sends a message, because object migration is relatively rare after all, only the first time to query, then cache the InstanceId, and re-query after the failure to send.</li> <li>actor object in the migration process, it is possible that other processes send over messages, when an error will occur, so the location server provides a Lock mechanism. Before the object is transmitted, the information in the process is deleted, and then a lock is added to the location server, and once the lock is on, other requests for the key will be queued.</li> <li>before transmission because the other party deleted the actor of the process, so other processes will fail to send, then they will retry. When retrying, they will re-request the location server, which will be found to be locked, so they will keep waiting.</li> <li>When the transmission is completed, the lock on the location server is unlocked, and the new address is updated, and then other location requests are responded to. Other requests sent to this actor continue.</li></ol> <p>Note that the Actor model is purely a server-side message communication mechanism, which has nothing to do with the client. We can use the server-side actor model for forwarding, so some client-side messages also inherit the actor interface. What happens if we don't use the actor interface on the client side? For example, the message Frame_ClickMap</p> <div class="language-protobuf line-numbers-mode"><pre class="language-protobuf"><code><span class="token keyword">message</span> Frame_ClickMap <span class="token comment">// IActorLocationMessage</span>
<span class="token punctuation">{</span>
	<span class="token builtin">int64</span> ActorId <span class="token operator">=</span> <span class="token number">93</span><span class="token punctuation">;</span>
	<span class="token builtin">int64</span> Id <span class="token operator">=</span> <span class="token number">94</span><span class="token punctuation">;</span>
	
	<span class="token builtin">float</span> X <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	<span class="token builtin">float</span> Y <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
	<span class="token builtin">float</span> Z <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>We may not need the field ActorId, the message is sent to Gate, gate sees that it is a Frame_ClickMap message, it needs to be forwarded to the Unit on the Map, forwarding is still good, gate can get the location of the unit corresponding to the map from the session, and then forward it, the problem comes, Frame_ ClickMap message to the map, how does the map know which object the message needs to be given to? There are several designs at this point.</p> <ol><li>bring the Id of the unit in the underlying protocol of forwarding, which requires more complex underlying protocol support.</li> <li>use a message to Frame_ClickMap message wrapping, wrapping the message with the Id of the Unit, wrapping with the message means greater consumption, increasing GC.
Personally, I feel that these two are very poor, not good, and even if distributed to the unit object processing, how to solve the problem of message re-entry it? unit object still needs to hang a message processing queue, and then receive the message thrown into the queue. Isn't this a duplication of the actor model? The current ET message sent to unit in the client did a design, the message into an actor message, gate received found to be an actor message, sent directly to the corresponding actor, the solution can be said to be beautiful. In fact, the client is still using session.send and call to send messages, send the message does not know that the message is an actor message, only to the gate, the gate judgment, refer to OuterMessageDispatcher.cs</li></ol> <h3 id="actor-location-message-processing"><a href="#actor-location-message-processing" class="header-anchor">#</a> Actor Location message processing</h3> <p>ActorLocation messages are sent</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code><span class="token comment">// Get the ActorLocationSenderComponent from Game.Scene, then get the ActorLocationSender via Entity.Id</span>
<span class="token class-name">ActorLocationSender</span> actorLocationSender <span class="token operator">=</span> Game<span class="token punctuation">.</span>Scene<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ActorLocationSenderComponent<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span>unitId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Send the message through the ActorLocationSender</span>
actorLocationSender<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span>actorLocationMessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// send the Rpc message</span>
<span class="token class-name">IResponse</span> response <span class="token operator">=</span> <span class="token keyword">await</span> actorLocationSender<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span>actorLocationRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>ActorLocation message processing is almost the same as Actor messages, the difference is that the two abstract classes inherited are different, note that the abstract class of actorlocation has an additional Location</p> <div class="language-csharp line-numbers-mode"><pre class="language-csharp"><code>	<span class="token comment">// The first generic parameter of the abstract class is the type of the Actor, and the second parameter is the type of the message.</span>
	<span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">ActorMessageHandler</span><span class="token attribute-arguments"><span class="token punctuation">(</span>AppType<span class="token punctuation">.</span>Map<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Frame_ClickMapHandler</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AMActorLocationHandler<span class="token punctuation">&lt;</span>Unit<span class="token punctuation">,</span> Frame_ClickMap<span class="token punctuation">&gt;</span></span></span>
	<span class="token punctuation">{</span>
		<span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">ETTask</span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token class-name">Unit</span> unit<span class="token punctuation">,</span> <span class="token class-name">Frame_ClickMap</span> message<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token class-name">Vector3</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Vector3</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>X<span class="token punctuation">,</span> message<span class="token punctuation">.</span>Y<span class="token punctuation">,</span> message<span class="token punctuation">.</span>Z<span class="token punctuation">)</span><span class="token punctuation">;</span>
			unit<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetComponent</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>UnitPathComponent<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">MoveTo</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Coroutine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token comment">// To handle Rpc messages, you need to inherit the AMActorRpcHandler abstract class. The first generic parameter of the abstract class is the type of the Actor, the second parameter is the type of the message, and the third parameter is the type of the returned message</span>
	<span class="token punctuation">[</span><span class="token function">ActorMessageHandler</span><span class="token punctuation">(</span>AppType<span class="token punctuation">.</span>Map<span class="token punctuation">)</span><span class="token punctuation">]</span>
	<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">C2M_TestActorRequestHandler</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">AMActorLocationRpcHandler<span class="token punctuation">&lt;</span>Unit<span class="token punctuation">,</span> C2M_TestActorRequest<span class="token punctuation">,</span> M2C_TestActorResponse<span class="token punctuation">&gt;</span></span></span>
	<span class="token punctuation">{</span>
		<span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token keyword">async</span> <span class="token return-type class-name">ETTask</span> <span class="token function">Run</span><span class="token punctuation">(</span><span class="token class-name">Unit</span> unit<span class="token punctuation">,</span> <span class="token class-name">C2M_TestActorRequest</span> message<span class="token punctuation">,</span> <span class="token class-name">Action<span class="token punctuation">&lt;</span>M2C_TestActorResponse<span class="token punctuation">&gt;</span></span> reply<span class="token punctuation">)</span>
		<span class="token punctuation">{</span>
			<span class="token function">reply</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">M2C_TestActorResponse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>Info <span class="token operator">=</span> <span class="token string">&quot;actor rpc response&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">await</span> ETTask<span class="token punctuation">.</span>CompletedTask<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="et-s-actor-and-actor-location-analogy"><a href="#et-s-actor-and-actor-location-analogy" class="header-anchor">#</a> ET's actor and actor location analogy</h3> <p>There are many cities (processes) in China, and many people (entity objects) living in the cities, each with an ID number (Entity.Id). A person needs to apply for a residence permit in each city and is assigned a unique residence permit number (InstanceId). The format of the residence permit number is 2 bytes city number + 4 bytes time + 2 bytes increment. The ID number never changes, but the residence permit number changes every time you go to a city.
Now there is a China Post (actor). Suppose Xiaoming wants to send a letter to his girlfriend Xiaohong</p> <ol><li>Xiaohong must mount a mailbox (MailboxComponent) himself in order to receive the letter, and Xiaohong will process the message when he receives it. Note that processing is done here one by one. It is possible that Hong will receive letters from many people at the same time. But she must read one letter at a time. Let's say Xiaoming and Xiaobao both send letters to Xiaohong, and Xiaohong receives Xiaoming's letter first, and then Xiaobao's letter. Xiaohong reads Xiaoming's letter first, and Xiaoming's letter asks Xiaohong to make a phone call to her grandmother (to produce a concordance) and then write back to herself, noting that Xiaohong also cannot read the next letter during this period, and must finish the phone call before she can read Xiaobao's letter. Of course Xiao Hong himself can choose to start reading Xiao Bao's letter without finishing the process, by opening a new concatenation for Xiao Ming's letter.</li> <li>Suppose Xiaoming knows Xiaohong's residence permit number, then the post (actor) can find the city (process) where Xiaohong lives according to the two docks of the residence permit number, and then find Xiaohong and deliver the message to Xiaohong's mailbox (MailboxComponent) according to Xiaohong's residence permit number. This is the simplest native actor model</li> <li>ET also supports a set of actor location mechanism. Suppose Xiao Ming doesn't know Xiao Hong's residence permit number, but he knows Xiao Hong's ID number, what should he do? The postal service has developed a set of advanced post (actor location) to think of a way, if a person often moves, it still wants to receive letters, then he must report his residence permit and ID card to the central government (location server) when he goes to a new city, so that the advanced post can send mail through the ID card number. The method is to go to the central government to get Hong's residence permit number, and then use the actor mechanism to send. 4.</li> <li>Suppose Xiao Hong was in Guangzhou city before, and Xiao Ming used Xiao Hong's ID card to send a letter to Xiao Hong. Advanced post obtains Xiao Hong's residence permit number and sends a letter to Xiao Hong. During this process of sending the letter, Xiaohong moved, from Guangzhou to Shenzhen, at which time Xiaohong reported her new residence permit on the central government. When the letter from the senior post arrives in Guangzhou, it is found that Xiao Hong is not in Guangzhou. Then the senior postal service will go to the central government again to get Xiao Hong's residence permit and resend it, which may succeed or fail again, this process will be repeated several times, if it is unsuccessful, it will tell Xiao Ming that the letter has failed to be sent.</li> <li>senior postal mail is more expensive, and people do not move a lot, usually Xiao Ming will remember Xiao Hong's residence permit after sending letters with senior postal mail, and next time send letters directly with the residence permit, and then send letters with senior postal mail if it fails.
There are two kinds of return receipts, one without content, just means Xiao Hong received the letter, and one with Xiao Hong's return letter. Xiaoming can choose which return receipt form to use when he sends the letter. Xiao Ming cannot send two letters to Xiao Hong at the same time, he must wait for Xiao Hong's acknowledgement to arrive before Xiao Ming can continue sending the letter.</li></ol></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/zxt385189207/ET-homepage/edit/main/docs/02.Guide/01.ETBook_English/55.5.5Actor Location-EN.md" target="_blank" rel="noopener noreferrer">在Github上编辑此页面!</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/07/25, 23:10:19</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/a3279e/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Actor Model</div></a> <a href="/pages/ae8fe0/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Numerical component design</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/a3279e/" class="prev">Actor Model</a></span> <span class="next"><a href="/pages/ae8fe0/">Numerical component design</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:385189207@qq.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/egametang/ET" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2022
    <span>d | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ffc2a9fd.js" defer></script><script src="/assets/js/2.fbbdf61d.js" defer></script><script src="/assets/js/33.b6c2eaeb.js" defer></script>
  </body>
</html>
